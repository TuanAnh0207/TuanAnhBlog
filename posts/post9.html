<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fetch API & JSON</title>
  <link rel="stylesheet" href="../assets/css/index.css" />
</head>
<body>
  <header class="header">
    <div class="header__container">
      <a href="../index.html" class="header__title">Tuấn Anh Blog</a>
      <nav class="header__nav">
        <a class="header__nav-link" href="../index.html">Home</a>
      </nav>
    </div>
  </header>
  <main class="post" style="max-width: 820px; margin: 2rem auto; padding: 0 1rem;">
    <h1 class="post__title">Fetch API & JSON</h1>
    <img class="post-hero" src="../assets/images/Post/Fetch API and JSON.png" alt="Fetch API JSON" />
    <p class="post__summary">Gọi API hiện đại với fetch, xử lý JSON, và bắt lỗi hợp lý: cấu trúc request, headers, retries đơn giản.</p>
    <h2>fetch cơ bản</h2>
    <p>Dùng <code>await fetch(url)</code>, kiểm tra <code>res.ok</code>, parse <code>await res.json()</code>.</p>
    <h2>Xử lý lỗi</h2>
    <p>Bọc try/catch, hiển thị thông báo phù hợp; với HTTP 4xx/5xx cần xử lý riêng.</p>
    <pre><code>async function getJSON(url, opts={}){
  const res = await fetch(url, { headers: { 'Accept': 'application/json' }, ...opts });
  if(!res.ok) throw new Error('HTTP '+res.status);
  return await res.json();
}

// retry 3 lần với backoff
async function getWithRetry(url){
  for(let i=0;i<3;i++){
    try{ return await getJSON(url); }
    catch(e){ await new Promise(r=>setTimeout(r, (i+1)*300)); }
  }
  throw new Error('Failed after retries');
}</code></pre>
    <section class="related">
      <h3 class="related__title">Bài viết gần đây</h3>
      <div class="related__grid">
        <a class="related-card" href="./post7.html"><img class="related-card__thumb" src="../assets/images/BATUOC.png" alt="Promise" /><div class="related-card__body"><h4 class="related-card__title">Promise & await</h4><p class="related-card__desc">Chuỗi bất đồng bộ.</p></div></a>
        <a class="related-card" href="./post8.html"><img class="related-card__thumb" src="../assets/images/BATUOC.png" alt="DOM" /><div class="related-card__body"><h4 class="related-card__title">DOM & Event</h4><p class="related-card__desc">Tối ưu thao tác DOM.</p></div></a>
        <a class="related-card" href="./post6.html"><img class="related-card__thumb" src="../assets/images/BATUOC.png" alt="Scope" /><div class="related-card__body"><h4 class="related-card__title">Scope & Closure</h4><p class="related-card__desc">Nền tảng JS.</p></div></a>
      </div>
    </section>
    <h2>POST/PUT với JSON</h2>
    <pre><code>async function postJSON(url, data){
  const res = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
  if(!res.ok) throw new Error('HTTP '+res.status);
  return res.json();
}</code></pre>
    <h2>Abort request</h2>
    <pre><code>const c = new AbortController();
setTimeout(()=> c.abort(), 1500);
await fetch('/slow', { signal: c.signal });</code></pre>
    <h2>Cache & ETag</h2>
    <p>Tận dụng <code>ETag</code>, <code>If-None-Match</code> để giảm payload; phía client kiểm tra 304 và dùng cache.</p>
    <h2>FAQ</h2>
    <p><strong>fetch có tự reject khi HTTP 4xx/5xx?</strong> Không, cần kiểm tra <code>res.ok</code> rồi ném lỗi thủ công.</p>
  </main>
</body>
</html>

